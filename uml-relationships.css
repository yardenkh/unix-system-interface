/* UML Relationships & Arrows - Complete relationship system for UML diagrams */

/* === RELATIONSHIP VARIABLES === */
:root {
  /* Arrow and line styling */
  --uml-line-color: #2c3e50;
  --uml-line-width: 2px;
  --uml-arrow-size: 8px;
  --uml-relationship-z: 5;

  /* Arrow head shapes */
  --uml-arrow-solid: 0 0, var(--uml-arrow-size) calc(var(--uml-arrow-size) / 2),
    0 var(--uml-arrow-size);
  --uml-arrow-open: 0 0, var(--uml-arrow-size) calc(var(--uml-arrow-size) / 2),
    0 var(--uml-arrow-size);
  --uml-diamond-size: 10px;

  /* Relationship colors */
  --uml-inheritance-color: #27ae60;
  --uml-composition-color: #e74c3c;
  --uml-aggregation-color: #f39c12;
  --uml-association-color: #3498db;
  --uml-dependency-color: #9b59b6;

  /* Label styling */
  --uml-label-background: rgba(255, 255, 255, 0.9);
  --uml-label-border: 1px solid #bdc3c7;
  --uml-label-padding: 4px 8px;
  --uml-label-font-size: 0.75em;
  --uml-label-border-radius: 4px;

  /* Multiplicity styling */
  --uml-multiplicity-font-size: 0.7em;
  --uml-multiplicity-color: #7f8c8d;
  --uml-multiplicity-background: rgba(255, 255, 255, 0.8);
}

/* === BASE RELATIONSHIP CONTAINER === */
.uml-relationship {
  position: absolute;
  pointer-events: none;
  z-index: var(--uml-relationship-z);
  overflow: visible;
}

/* === CONNECTION LINES === */
.uml-line {
  position: absolute;
  background: var(--line-color, var(--uml-line-color));
  pointer-events: none;
  z-index: var(--uml-relationship-z);
}

/* Horizontal and vertical lines */
.uml-line.horizontal {
  height: var(--line-width, var(--uml-line-width));
  width: var(--line-length, 100px);
  top: var(--y, 0);
  left: var(--x, 0);
}

.uml-line.vertical {
  width: var(--line-width, var(--uml-line-width));
  height: var(--line-length, 100px);
  top: var(--y, 0);
  left: var(--x, 0);
}

/* Diagonal lines using transforms */
.uml-line.diagonal {
  width: var(--line-length, 100px);
  height: var(--line-width, var(--uml-line-width));
  top: var(--y, 0);
  left: var(--x, 0);
  transform-origin: left center;
  transform: rotate(var(--angle, 0deg));
}

/* === ARROW HEADS === */
.uml-arrow-head {
  position: absolute;
  width: 0;
  height: 0;
  z-index: calc(var(--uml-relationship-z) + 1);
}

/* Solid arrow (inheritance, realization) */
.uml-arrow-head.solid {
  border-left: var(--uml-arrow-size) solid
    var(--arrow-color, var(--uml-inheritance-color));
  border-top: calc(var(--uml-arrow-size) / 2) solid transparent;
  border-bottom: calc(var(--uml-arrow-size) / 2) solid transparent;
}

/* Open arrow (association) */
.uml-arrow-head.open {
  border-left: var(--uml-arrow-size) solid transparent;
  border-top: calc(var(--uml-arrow-size) / 2) solid
    var(--arrow-color, var(--uml-association-color));
  border-bottom: calc(var(--uml-arrow-size) / 2) solid
    var(--arrow-color, var(--uml-association-color));
  border-right: none;
  background: transparent;
}

/* Diamond shapes for composition/aggregation */
.uml-arrow-head.diamond {
  width: var(--uml-diamond-size);
  height: var(--uml-diamond-size);
  background: var(--diamond-color, var(--uml-composition-color));
  transform: rotate(45deg);
  border: 1px solid var(--diamond-border, var(--uml-line-color));
}

.uml-arrow-head.diamond.hollow {
  background: white;
}

/* === RELATIONSHIP TYPES === */

/* Inheritance (solid line, solid arrow) */
.uml-relationship.inheritance .uml-line {
  background: var(--uml-inheritance-color);
}

.uml-relationship.inheritance .uml-arrow-head {
  --arrow-color: var(--uml-inheritance-color);
}

/* Composition (solid line, filled diamond) */
.uml-relationship.composition .uml-line {
  background: var(--uml-composition-color);
}

.uml-relationship.composition .uml-arrow-head.diamond {
  --diamond-color: var(--uml-composition-color);
}

/* Aggregation (solid line, hollow diamond) */
.uml-relationship.aggregation .uml-line {
  background: var(--uml-aggregation-color);
}

.uml-relationship.aggregation .uml-arrow-head.diamond {
  --diamond-color: white;
  --diamond-border: var(--uml-aggregation-color);
}

/* Association (solid line, open arrow) */
.uml-relationship.association .uml-line {
  background: var(--uml-association-color);
}

.uml-relationship.association .uml-arrow-head {
  --arrow-color: var(--uml-association-color);
}

/* Dependency (dashed line, open arrow) */
.uml-relationship.dependency .uml-line {
  background: repeating-linear-gradient(
    to right,
    var(--uml-dependency-color) 0px,
    var(--uml-dependency-color) 5px,
    transparent 5px,
    transparent 10px
  );
}

.uml-relationship.dependency .uml-arrow-head {
  --arrow-color: var(--uml-dependency-color);
}

/* === LABELS AND ANNOTATIONS === */
.uml-relationship-label {
  position: absolute;
  background: var(--uml-label-background);
  border: var(--uml-label-border);
  padding: var(--uml-label-padding);
  font-size: var(--uml-label-font-size);
  border-radius: var(--uml-label-border-radius);
  white-space: nowrap;
  z-index: calc(var(--uml-relationship-z) + 2);
  pointer-events: auto;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.uml-multiplicity {
  position: absolute;
  font-size: var(--uml-multiplicity-font-size);
  color: var(--uml-multiplicity-color);
  background: var(--uml-multiplicity-background);
  padding: 2px 4px;
  border-radius: 2px;
  font-weight: bold;
  z-index: calc(var(--uml-relationship-z) + 2);
}

/* === POSITIONING HELPERS === */

/* Automatic positioning from data attributes */
.uml-relationship[data-from][data-to] {
  /* Will be positioned via JavaScript or specific coordinate variables */
}

/* Manual positioning using CSS variables */
.uml-relationship.positioned {
  left: var(--start-x, 0);
  top: var(--start-y, 0);
  width: var(--connection-width, 200px);
  height: var(--connection-height, 100px);
}

/* === RELATIONSHIP PRESETS === */

/* Scheduler to Coroutines */
.uml-relationship.scheduler-to-coroutine1 {
  --start-x: calc(var(--scheduler-x) + 125px);
  --start-y: calc(var(--scheduler-y) + 180px);
  --end-x: calc(var(--coroutine1-x) + 125px);
  --end-y: var(--coroutine1-y);
}

.uml-relationship.scheduler-to-coroutine2 {
  --start-x: calc(var(--scheduler-x) + 125px);
  --start-y: calc(var(--scheduler-y) + 180px);
  --end-x: calc(var(--coroutine2-x) + 125px);
  --end-y: var(--coroutine2-y);
}

/* Coroutines to Context Switcher */
.uml-relationship.coroutine1-to-context {
  --start-x: calc(var(--coroutine1-x) + 125px);
  --start-y: calc(var(--coroutine1-y) + 180px);
  --end-x: calc(var(--context-switcher-x) + 125px);
  --end-y: var(--context-switcher-y);
}

.uml-relationship.coroutine2-to-context {
  --start-x: calc(var(--coroutine2-x) + 125px);
  --start-y: calc(var(--coroutine2-y) + 180px);
  --end-x: calc(var(--context-switcher-x) + 125px);
  --end-y: var(--context-switcher-y);
}

/* CCB Manager relationships */
.uml-relationship.ccb-to-context {
  --start-x: calc(var(--ccb-manager-x) + 200px);
  --start-y: calc(var(--ccb-manager-y) + 90px);
  --end-x: var(--context-switcher-x);
  --end-y: calc(var(--context-switcher-y) + 90px);
}

/* === ANIMATION EFFECTS === */
.uml-relationship.animated .uml-line {
  animation: flowConnection 3s infinite linear;
}

@keyframes flowConnection {
  0% {
    background-position: 0% 0%;
  }
  100% {
    background-position: 20px 0%;
  }
}

.uml-relationship.animated.dependency .uml-line {
  background: repeating-linear-gradient(
    to right,
    var(--uml-dependency-color) 0px,
    var(--uml-dependency-color) 5px,
    transparent 5px,
    transparent 10px
  );
  background-size: 20px 100%;
}
